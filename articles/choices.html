<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simulating Choices • cbcTools</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulating Choices">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cbcTools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/getting-started.html">Getting Started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/profiles.html">Generating Profiles</a></li>
    <li><a class="dropdown-item" href="../articles/priors.html">Specifying Priors</a></li>
    <li><a class="dropdown-item" href="../articles/design.html">Generating Designs</a></li>
    <li><a class="dropdown-item" href="../articles/d_error.html">Computing D-Error</a></li>
    <li><a class="dropdown-item" href="../articles/choices.html">Simulating Choices</a></li>
    <li><a class="dropdown-item" href="../articles/power.html">Power Analysis</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jhelvy/cbcTools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Simulating Choices</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jhelvy/cbcTools/blob/main/vignettes/choices.Rmd" class="external-link"><code>vignettes/choices.Rmd</code></a></small>
      <div class="d-none name"><code>choices.Rmd</code></div>
    </div>

    
    
<p>Choice simulation converts experimental designs into realistic choice
data by predicting how respondents would answer choice questions. This
is essential for testing designs, conducting power analyses, and
validating experimental assumptions before data collection. This article
shows how to use <code><a href="../reference/cbc_choices.html">cbc_choices()</a></code> to simulate choice
patterns.</p>
<p>Before starting, let’s define some basic profiles and a basic random
design to work with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jhelvy/cbcTools" class="external-link">cbcTools</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">profiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cbc_profiles.html">cbc_profiles</a></span><span class="op">(</span></span>
<span>  price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2</span>, <span class="fl">2.5</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Fuji'</span>, <span class="st">'Gala'</span>, <span class="st">'Honeycrisp'</span><span class="op">)</span>,</span>
<span>  freshness <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Poor'</span>, <span class="st">'Average'</span>, <span class="st">'Excellent'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cbc_design.html">cbc_design</a></span><span class="op">(</span></span>
<span>  profiles <span class="op">=</span> <span class="va">profiles</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"random"</span>,</span>
<span>  n_alts <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  n_q <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  n_resp <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">design</span></span>
<span><span class="co">#&gt; Design method: random</span></span>
<span><span class="co">#&gt; Structure: 100 respondents × 6 questions × 2 alternatives</span></span>
<span><span class="co">#&gt; Profile usage: 45/45 (100.0%)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 💡 Use cbc_inspect() for a more detailed summary</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; First few rows of design:</span></span>
<span><span class="co">#&gt;   profileID respID qID altID obsID price typeGala typeHoneycrisp</span></span>
<span><span class="co">#&gt; 1        31      1   1     1     1   1.0        0              0</span></span>
<span><span class="co">#&gt; 2        15      1   1     2     1   3.0        0              1</span></span>
<span><span class="co">#&gt; 3        14      1   2     1     2   2.5        0              1</span></span>
<span><span class="co">#&gt; 4         3      1   2     2     2   2.0        0              0</span></span>
<span><span class="co">#&gt; 5        42      1   3     1     3   1.5        0              1</span></span>
<span><span class="co">#&gt; 6        43      1   3     2     3   2.0        0              1</span></span>
<span><span class="co">#&gt;   freshnessAverage freshnessExcellent</span></span>
<span><span class="co">#&gt; 1                0                  1</span></span>
<span><span class="co">#&gt; 2                0                  0</span></span>
<span><span class="co">#&gt; 3                0                  0</span></span>
<span><span class="co">#&gt; 4                0                  0</span></span>
<span><span class="co">#&gt; 5                0                  1</span></span>
<span><span class="co">#&gt; 6                0                  1</span></span>
<span><span class="co">#&gt; ... and 1194 more rows</span></span></code></pre></div>
<div class="section level2">
<h2 id="choice-simulation-approaches">Choice Simulation Approaches<a class="anchor" aria-label="anchor" href="#choice-simulation-approaches"></a>
</h2>
<p><code><a href="../reference/cbc_choices.html">cbc_choices()</a></code> supports two simulation approaches:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Random simulation</strong>: Each alternative has equal
probability of being chosen</li>
<li>
<strong>Utility-based simulation</strong>: Choice probabilities
based on multinomial logit model with specified priors</li>
</ol>
<div class="section level3">
<h3 id="random-choices">Random Choices<a class="anchor" aria-label="anchor" href="#random-choices"></a>
</h3>
<p>Without priors, choices are simulated randomly with equal
probabilities:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Random choice simulation (default)</span></span>
<span><span class="va">choices_random</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cbc_choices.html">cbc_choices</a></span><span class="op">(</span><span class="va">design</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">choices_random</span><span class="op">)</span></span>
<span><span class="co">#&gt; CBC Choice Data</span></span>
<span><span class="co">#&gt; ===============</span></span>
<span><span class="co">#&gt; Observations: 3 choice tasks</span></span>
<span><span class="co">#&gt; Alternatives per task: 2</span></span>
<span><span class="co">#&gt; Total choices made: 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Simulation method: random</span></span>
<span><span class="co">#&gt; Priors: None (random choices)</span></span>
<span><span class="co">#&gt; Simulated at: 2025-08-10 18:44:13</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Choice rates by alternative:</span></span>
<span><span class="co">#&gt;   Alt 1: 33.3% (1 choices)</span></span>
<span><span class="co">#&gt;   Alt 2: 66.7% (2 choices)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; First few rows:</span></span>
<span><span class="co">#&gt;   profileID respID qID altID obsID price typeGala typeHoneycrisp</span></span>
<span><span class="co">#&gt; 1        31      1   1     1     1   1.0        0              0</span></span>
<span><span class="co">#&gt; 2        15      1   1     2     1   3.0        0              1</span></span>
<span><span class="co">#&gt; 3        14      1   2     1     2   2.5        0              1</span></span>
<span><span class="co">#&gt; 4         3      1   2     2     2   2.0        0              0</span></span>
<span><span class="co">#&gt; 5        42      1   3     1     3   1.5        0              1</span></span>
<span><span class="co">#&gt; 6        43      1   3     2     3   2.0        0              1</span></span>
<span><span class="co">#&gt;   freshnessAverage freshnessExcellent choice</span></span>
<span><span class="co">#&gt; 1                0                  1      0</span></span>
<span><span class="co">#&gt; 2                0                  0      1</span></span>
<span><span class="co">#&gt; 3                0                  0      0</span></span>
<span><span class="co">#&gt; 4                0                  0      1</span></span>
<span><span class="co">#&gt; 5                0                  1      1</span></span>
<span><span class="co">#&gt; 6                0                  1      0</span></span>
<span></span>
<span><span class="co"># Check choice distribution</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">choices_random</span><span class="op">$</span><span class="va">choice</span>, <span class="va">choices_random</span><span class="op">$</span><span class="va">altID</span><span class="op">)</span></span>
<span><span class="co">#&gt;    </span></span>
<span><span class="co">#&gt;       1   2</span></span>
<span><span class="co">#&gt;   0 294 306</span></span>
<span><span class="co">#&gt;   1 306 294</span></span></code></pre></div>
<p>Random simulation is useful for:</p>
<ul>
<li>Quick testing of design structure</li>
<li>Conservative power analysis (worst-case scenario)</li>
<li>Baseline comparisons</li>
</ul>
</div>
<div class="section level3">
<h3 id="utility-based-choices">Utility-Based Choices<a class="anchor" aria-label="anchor" href="#utility-based-choices"></a>
</h3>
<p>With priors, choices follow realistic utility-based patterns:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create priors for utility-based simulation</span></span>
<span><span class="va">priors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cbc_priors.html">cbc_priors</a></span><span class="op">(</span></span>
<span>  profiles <span class="op">=</span> <span class="va">profiles</span>,</span>
<span>  price <span class="op">=</span> <span class="op">-</span><span class="fl">0.25</span>, <span class="co"># Negative preference for higher prices</span></span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>, <span class="co"># Gala and Honeycrisp preferred over Fuji</span></span>
<span>  freshness <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">1.2</span><span class="op">)</span> <span class="co"># Average and Excellent preferred over Poor</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Utility-based choice simulation</span></span>
<span><span class="va">choices_utility</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cbc_choices.html">cbc_choices</a></span><span class="op">(</span><span class="va">design</span>, priors <span class="op">=</span> <span class="va">priors</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">choices_utility</span><span class="op">)</span></span>
<span><span class="co">#&gt; CBC Choice Data</span></span>
<span><span class="co">#&gt; ===============</span></span>
<span><span class="co">#&gt; Observations: 3 choice tasks</span></span>
<span><span class="co">#&gt; Alternatives per task: 2</span></span>
<span><span class="co">#&gt; Total choices made: 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Simulation method: utility_based</span></span>
<span><span class="co">#&gt; Priors: Used for utility-based simulation</span></span>
<span><span class="co">#&gt; Simulated at: 2025-08-10 18:44:13</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Choice rates by alternative:</span></span>
<span><span class="co">#&gt;   Alt 1: 66.7% (2 choices)</span></span>
<span><span class="co">#&gt;   Alt 2: 33.3% (1 choices)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; First few rows:</span></span>
<span><span class="co">#&gt;   profileID respID qID altID obsID price typeGala typeHoneycrisp</span></span>
<span><span class="co">#&gt; 1        31      1   1     1     1   1.0        0              0</span></span>
<span><span class="co">#&gt; 2        15      1   1     2     1   3.0        0              1</span></span>
<span><span class="co">#&gt; 3        14      1   2     1     2   2.5        0              1</span></span>
<span><span class="co">#&gt; 4         3      1   2     2     2   2.0        0              0</span></span>
<span><span class="co">#&gt; 5        42      1   3     1     3   1.5        0              1</span></span>
<span><span class="co">#&gt; 6        43      1   3     2     3   2.0        0              1</span></span>
<span><span class="co">#&gt;   freshnessAverage freshnessExcellent choice</span></span>
<span><span class="co">#&gt; 1                0                  1      1</span></span>
<span><span class="co">#&gt; 2                0                  0      0</span></span>
<span><span class="co">#&gt; 3                0                  0      0</span></span>
<span><span class="co">#&gt; 4                0                  0      1</span></span>
<span><span class="co">#&gt; 5                0                  1      1</span></span>
<span><span class="co">#&gt; 6                0                  1      0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="choice-data-format">Choice Data Format<a class="anchor" aria-label="anchor" href="#choice-data-format"></a>
</h3>
<p>The simulated choice data includes all design columns plus a
<code>choice</code> column:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">choices_utility</span><span class="op">)</span></span>
<span><span class="co">#&gt; CBC Choice Data</span></span>
<span><span class="co">#&gt; ===============</span></span>
<span><span class="co">#&gt; Observations: 3 choice tasks</span></span>
<span><span class="co">#&gt; Alternatives per task: 2</span></span>
<span><span class="co">#&gt; Total choices made: 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Simulation method: utility_based</span></span>
<span><span class="co">#&gt; Priors: Used for utility-based simulation</span></span>
<span><span class="co">#&gt; Simulated at: 2025-08-10 18:44:13</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Choice rates by alternative:</span></span>
<span><span class="co">#&gt;   Alt 1: 66.7% (2 choices)</span></span>
<span><span class="co">#&gt;   Alt 2: 33.3% (1 choices)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; First few rows:</span></span>
<span><span class="co">#&gt;   profileID respID qID altID obsID price typeGala typeHoneycrisp</span></span>
<span><span class="co">#&gt; 1        31      1   1     1     1   1.0        0              0</span></span>
<span><span class="co">#&gt; 2        15      1   1     2     1   3.0        0              1</span></span>
<span><span class="co">#&gt; 3        14      1   2     1     2   2.5        0              1</span></span>
<span><span class="co">#&gt; 4         3      1   2     2     2   2.0        0              0</span></span>
<span><span class="co">#&gt; 5        42      1   3     1     3   1.5        0              1</span></span>
<span><span class="co">#&gt; 6        43      1   3     2     3   2.0        0              1</span></span>
<span><span class="co">#&gt;   freshnessAverage freshnessExcellent choice</span></span>
<span><span class="co">#&gt; 1                0                  1      1</span></span>
<span><span class="co">#&gt; 2                0                  0      0</span></span>
<span><span class="co">#&gt; 3                0                  0      0</span></span>
<span><span class="co">#&gt; 4                0                  0      1</span></span>
<span><span class="co">#&gt; 5                0                  1      1</span></span>
<span><span class="co">#&gt; 6                0                  1      0</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="advanced-simulation-options">Advanced Simulation Options<a class="anchor" aria-label="anchor" href="#advanced-simulation-options"></a>
</h2>
<div class="section level3">
<h3 id="designs-with-no-choice">Designs with No-Choice<a class="anchor" aria-label="anchor" href="#designs-with-no-choice"></a>
</h3>
<p>For designs with no-choice options, specify no-choice priors:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create design with no-choice option</span></span>
<span><span class="va">design_nochoice</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cbc_design.html">cbc_design</a></span><span class="op">(</span></span>
<span>  profiles <span class="op">=</span> <span class="va">profiles</span>,</span>
<span>  n_alts <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  n_q <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  n_resp <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  no_choice <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"random"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create priors including no-choice utility</span></span>
<span><span class="va">priors_nochoice</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cbc_priors.html">cbc_priors</a></span><span class="op">(</span></span>
<span>  profiles <span class="op">=</span> <span class="va">profiles</span>,</span>
<span>  price <span class="op">=</span> <span class="op">-</span><span class="fl">0.25</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1.0</span><span class="op">)</span>,</span>
<span>  freshness <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">1.2</span><span class="op">)</span>,</span>
<span>  no_choice <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span> <span class="co"># Negative = no-choice less attractive</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate choices</span></span>
<span><span class="va">choices_nochoice</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cbc_choices.html">cbc_choices</a></span><span class="op">(</span></span>
<span>  <span class="va">design_nochoice</span>,</span>
<span>  priors <span class="op">=</span> <span class="va">priors_nochoice</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Examine no-choice rates</span></span>
<span><span class="va">nochoice_rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">choices_nochoice</span><span class="op">$</span><span class="va">choice</span><span class="op">[</span><span class="va">choices_nochoice</span><span class="op">$</span><span class="va">no_choice</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"No-choice selection rate:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">nochoice_rate</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"%\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; No-choice selection rate: 13.3 %</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="random-parameters-mixed-logit">Random Parameters (Mixed Logit)<a class="anchor" aria-label="anchor" href="#random-parameters-mixed-logit"></a>
</h3>
<p>Simulate heterogeneous preferences using random parameters:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create priors with random parameters</span></span>
<span><span class="va">priors_random</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cbc_priors.html">cbc_priors</a></span><span class="op">(</span></span>
<span>  profiles <span class="op">=</span> <span class="va">profiles</span>,</span>
<span>  price <span class="op">=</span> <span class="fu"><a href="../reference/rand_spec.html">rand_spec</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="st">"n"</span>, mean <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>, sd <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="../reference/rand_spec.html">rand_spec</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="st">"n"</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  freshness <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span><span class="op">)</span>, <span class="co"># Keep some parameters fixed</span></span>
<span>  n_draws <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate choices with preference heterogeneity</span></span>
<span><span class="va">choices_mixed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cbc_choices.html">cbc_choices</a></span><span class="op">(</span><span class="va">design</span>, priors <span class="op">=</span> <span class="va">priors_random</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="interaction-effects">Interaction Effects<a class="anchor" aria-label="anchor" href="#interaction-effects"></a>
</h3>
<p>Include interaction effects in choice simulation:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create priors with interactions</span></span>
<span><span class="va">priors_interactions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cbc_priors.html">cbc_priors</a></span><span class="op">(</span></span>
<span>  profiles <span class="op">=</span> <span class="va">profiles</span>,</span>
<span>  price <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Fuji"</span> <span class="op">=</span> <span class="fl">0.5</span>, <span class="st">"Gala"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  freshness <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Average"</span> <span class="op">=</span> <span class="fl">0.6</span>, <span class="st">"Excellent"</span> <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span>,</span>
<span>  interactions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="co"># Price sensitivity varies by apple type</span></span>
<span>    <span class="fu"><a href="../reference/int_spec.html">int_spec</a></span><span class="op">(</span></span>
<span>      between <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"price"</span>, <span class="st">"type"</span><span class="op">)</span>,</span>
<span>      with_level <span class="op">=</span> <span class="st">"Fuji"</span>,</span>
<span>      value <span class="op">=</span> <span class="fl">0.5</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/int_spec.html">int_spec</a></span><span class="op">(</span></span>
<span>      between <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"price"</span>, <span class="st">"type"</span><span class="op">)</span>,</span>
<span>      with_level <span class="op">=</span> <span class="st">"Gala"</span>,</span>
<span>      value <span class="op">=</span> <span class="fl">0.2</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate choices with interaction effects</span></span>
<span><span class="va">choices_interactions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cbc_choices.html">cbc_choices</a></span><span class="op">(</span></span>
<span>  <span class="va">design</span>,</span>
<span>  priors <span class="op">=</span> <span class="va">priors_interactions</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="validating-choice-patterns">Validating Choice Patterns<a class="anchor" aria-label="anchor" href="#validating-choice-patterns"></a>
</h2>
<div class="section level3">
<h3 id="overall-choice-frequencies">Overall Choice Frequencies<a class="anchor" aria-label="anchor" href="#overall-choice-frequencies"></a>
</h3>
<p>Based on the priors used, we expect:</p>
<ul>
<li>
<strong>Lower prices preferred</strong> (negative price
coefficient)</li>
<li>
<strong>Honeycrisp &gt; Gala &gt; Fuji</strong> (type coefficients:
0.2 &gt; 0.1 &gt; 0)</li>
<li>
<strong>Excellent &gt; Average &gt; Poor</strong> (freshness
coefficients: 0.2 &gt; 0.1 &gt; 0)</li>
</ul>
<p>Examine aggregate choice patterns to validate simulation:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Decode the choice data first to get categorical variables</span></span>
<span><span class="va">choices_decoded</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cbc_decode.html">cbc_decode</a></span><span class="op">(</span><span class="va">choices_utility</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Aggregate attribute choices across all respondents</span></span>
<span><span class="va">choices</span> <span class="op">&lt;-</span> <span class="va">choices_decoded</span></span>
<span></span>
<span><span class="co"># Price choices</span></span>
<span><span class="va">price_choices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">choice</span> <span class="op">~</span> <span class="va">price</span>, data <span class="op">=</span> <span class="va">choices</span>, <span class="va">sum</span><span class="op">)</span></span>
<span><span class="va">price_choices</span><span class="op">$</span><span class="va">prop</span> <span class="op">&lt;-</span> <span class="va">price_choices</span><span class="op">$</span><span class="va">choice</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">price_choices</span><span class="op">$</span><span class="va">choice</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">price_choices</span><span class="op">)</span></span>
<span><span class="co">#&gt;   price choice      prop</span></span>
<span><span class="co">#&gt; 1   1.0    123 0.2050000</span></span>
<span><span class="co">#&gt; 2   1.5    119 0.1983333</span></span>
<span><span class="co">#&gt; 3   2.0    121 0.2016667</span></span>
<span><span class="co">#&gt; 4   2.5    107 0.1783333</span></span>
<span><span class="co">#&gt; 5   3.0    130 0.2166667</span></span>
<span></span>
<span><span class="co"># Type choices</span></span>
<span><span class="va">type_choices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">choice</span> <span class="op">~</span> <span class="va">type</span>, data <span class="op">=</span> <span class="va">choices</span>, <span class="va">sum</span><span class="op">)</span></span>
<span><span class="va">type_choices</span><span class="op">$</span><span class="va">prop</span> <span class="op">&lt;-</span> <span class="va">type_choices</span><span class="op">$</span><span class="va">choice</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">type_choices</span><span class="op">$</span><span class="va">choice</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">type_choices</span><span class="op">)</span></span>
<span><span class="co">#&gt;         type choice  prop</span></span>
<span><span class="co">#&gt; 1       Fuji    171 0.285</span></span>
<span><span class="co">#&gt; 2       Gala    213 0.355</span></span>
<span><span class="co">#&gt; 3 Honeycrisp    216 0.360</span></span>
<span></span>
<span><span class="co"># Freshness choices</span></span>
<span><span class="va">freshness_choices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">choice</span> <span class="op">~</span> <span class="va">freshness</span>, data <span class="op">=</span> <span class="va">choices</span>, <span class="va">sum</span><span class="op">)</span></span>
<span><span class="va">freshness_choices</span><span class="op">$</span><span class="va">prop</span> <span class="op">&lt;-</span> <span class="va">freshness_choices</span><span class="op">$</span><span class="va">choice</span> <span class="op">/</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">freshness_choices</span><span class="op">$</span><span class="va">choice</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">freshness_choices</span><span class="op">)</span></span>
<span><span class="co">#&gt;   freshness choice      prop</span></span>
<span><span class="co">#&gt; 1      Poor    145 0.2416667</span></span>
<span><span class="co">#&gt; 2   Average    210 0.3500000</span></span>
<span><span class="co">#&gt; 3 Excellent    245 0.4083333</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="respondent-heterogeneity">Respondent Heterogeneity<a class="anchor" aria-label="anchor" href="#respondent-heterogeneity"></a>
</h3>
<p>For random parameter models, examine variation across
respondents:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create dataset with only chosen alternatives</span></span>
<span><span class="va">chosen_alts</span> <span class="op">&lt;-</span> <span class="va">choices_mixed</span><span class="op">[</span><span class="va">choices_mixed</span><span class="op">$</span><span class="va">choice</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Mean attribute levels chosen by each respondent</span></span>
<span><span class="va">resp_means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>    <span class="va">price</span>,</span>
<span>    <span class="va">typeGala</span>,</span>
<span>    <span class="va">typeHoneycrisp</span>,</span>
<span>    <span class="va">freshnessAverage</span>,</span>
<span>    <span class="va">freshnessExcellent</span></span>
<span>  <span class="op">)</span> <span class="op">~</span></span>
<span>    <span class="va">respID</span>,</span>
<span>  data <span class="op">=</span> <span class="va">chosen_alts</span>,</span>
<span>  <span class="va">mean</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Look at variation across respondents</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Price variation across respondents:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Price variation across respondents:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Mean:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">resp_means</span><span class="op">$</span><span class="va">price</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Mean: 2.01</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"SD:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">resp_means</span><span class="op">$</span><span class="va">price</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; SD: 0.28</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nHoneycrisp choice rate variation:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Honeycrisp choice rate variation:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Mean:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">resp_means</span><span class="op">$</span><span class="va">typeHoneycrisp</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Mean: 0.32</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"SD:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">resp_means</span><span class="op">$</span><span class="va">typeHoneycrisp</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; SD: 0.2</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="design-consistency">Design Consistency<a class="anchor" aria-label="anchor" href="#design-consistency"></a>
</h2>
<div class="section level3">
<h3 id="using-consistent-priors">Using Consistent Priors<a class="anchor" aria-label="anchor" href="#using-consistent-priors"></a>
</h3>
<p>For D-optimal designs created with priors, use the same priors for
choice simulation:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create D-optimal design with priors</span></span>
<span><span class="va">design_optimal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cbc_design.html">cbc_design</a></span><span class="op">(</span></span>
<span>  profiles <span class="op">=</span> <span class="va">profiles</span>,</span>
<span>  n_alts <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  n_q <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  n_resp <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  priors <span class="op">=</span> <span class="va">priors</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"stochastic"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use SAME priors for choice simulation</span></span>
<span><span class="va">choices_consistent</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cbc_choices.html">cbc_choices</a></span><span class="op">(</span></span>
<span>  <span class="va">design_optimal</span>,</span>
<span>  priors <span class="op">=</span> <span class="va">priors</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="prior-consistency-warnings">Prior Consistency Warnings<a class="anchor" aria-label="anchor" href="#prior-consistency-warnings"></a>
</h3>
<p>cbcTools warns when different priors are used:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create different priors</span></span>
<span><span class="va">different_priors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cbc_priors.html">cbc_priors</a></span><span class="op">(</span></span>
<span>  profiles <span class="op">=</span> <span class="va">profiles</span>,</span>
<span>  price <span class="op">=</span> <span class="op">-</span><span class="fl">0.2</span>, <span class="co"># Different from design optimization</span></span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.4</span><span class="op">)</span>,</span>
<span>  freshness <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.4</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This will generate a warning about inconsistent priors</span></span>
<span><span class="va">choices_inconsistent</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cbc_choices.html">cbc_choices</a></span><span class="op">(</span></span>
<span>  <span class="va">design_optimal</span>,</span>
<span>  priors <span class="op">=</span> <span class="va">different_priors</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="best-practices">Best Practices<a class="anchor" aria-label="anchor" href="#best-practices"></a>
</h2>
<div class="section level3">
<h3 id="prior-specification">Prior Specification<a class="anchor" aria-label="anchor" href="#prior-specification"></a>
</h3>
<ul>
<li>
<strong>Use realistic priors</strong>: Base on literature, pilot
studies, or expert judgment</li>
<li>
<strong>Match design priors</strong>: Use same priors for design
optimization and choice simulation<br>
</li>
<li>
<strong>Test multiple scenarios</strong>: Simulate under optimistic
and conservative assumptions</li>
<li>
<strong>Include heterogeneity</strong>: Use random parameters when
appropriate</li>
</ul>
</div>
<div class="section level3">
<h3 id="validation-steps">Validation Steps<a class="anchor" aria-label="anchor" href="#validation-steps"></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<strong>Check choice counts</strong>: Verify one choice per
question</li>
<li>
<strong>Examine patterns</strong>: Ensure choices align with prior
expectations</li>
<li>
<strong>Test extremes</strong>: Simulate with very strong/weak
preferences</li>
<li>
<strong>Compare methods</strong>: Test different simulation
approaches</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<p>After simulating choices:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Conduct power analysis</strong> using
<code><a href="../reference/cbc_power.html">cbc_power()</a></code> to determine sample size requirements</li>
<li>
<strong>Compare designs</strong> by simulating choices for different
design methods</li>
<li>
<strong>Validate assumptions</strong> by checking if simulated
patterns match expectations</li>
<li>
<strong>Refine priors</strong> based on simulation results before
data collection</li>
</ol>
<p>For details on power analysis, see the <a href="power.Rmd">Power
Analysis</a> vignette.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by John Helveston.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
